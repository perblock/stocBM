
<!-- README.md is generated from README.Rmd. Please edit that file -->

# stocBM

A set of functions to get the partitions of a stochastic blockmodel for
mobility networks; that is, for a cross-classification matrix in which
rowsums differ between rows AND rowsums and columnsums differ. In other
words, a stochastic blockmodel for directed, weighted networks, which is
conditional on the in- and out-degree distribution.

## Installation

You can install the current version of stocBM from GitHub using:

``` r
# install.packages("remotes")
remotes::install_github("perblock/stocBM")
```

## Small example

First, we create a matrix of counts as an example and add some
structure:

``` r
library(stocBM)

test_mat <- matrix(rpois(1600, lambda = 10), nrow = 40, ncol = 40)
test_mat[1:15, 1:15] <- test_mat[1:15, 1:15] + 2  # Add some structure
test_mat[25:40, 16:24] <- test_mat[25:40, 16:24] + 3  # Add some structure

# Look at the first rows and columns
test_mat[1:10, 1:10]
#>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
#>  [1,]    8   13    9   16   14   16   15   16   14    15
#>  [2,]    6   17   10   14   15    8   10   12   15    11
#>  [3,]   15   15   13    8    5   13    8    9   15    13
#>  [4,]   10   14    8   12   17   14   15   11   12     8
#>  [5,]    8   15   16   12   13   15   14   10   15    12
#>  [6,]    5   15    9   13   17   12   14   10    9    11
#>  [7,]   13   11    9   15    9   11   12   15    8    13
#>  [8,]   13    8   15   15   12   11   17   13   13     9
#>  [9,]   10   10   14   13   14   12   10   13    9    12
#> [10,]   12   12   13   12   12    9   12   13   14     7
```

Now we can run a simple first test to get a (probably) preliminary
partitioning. In case the partitions are very clear, this might already
be pretty good.

``` r
init_res <- repeat_until_no_improvement(test_mat, n_blocks = 3, max_iter = 1000)
#> Iteration: 1 Fit (AIC): 327791.5 
#> Iteration: 2 Fit (AIC): 327785.7 
#> Iteration: 3 Fit (AIC): 327781.1 
#> Iteration: 4 Fit (AIC): 327777.3 
#> Iteration: 5 Fit (AIC): 327773.7 
#> Iteration: 6 Fit (AIC): 327770.2 
#> Iteration: 7 Fit (AIC): 327766 
#> Iteration: 8 Fit (AIC): 327761.8 
#> Iteration: 9 Fit (AIC): 327758.8 
#> Iteration: 10 Fit (AIC): 327757.3 
#> Iteration: 11 Fit (AIC): 327753.8 
#> Iteration: 12 Fit (AIC): 327752.4 
#> Iteration: 13 Fit (AIC): 327749.6
init_res$partition
#>  [1] 3 2 1 1 3 3 3 1 1 1 3 2 2 1 1 3 2 1 1 3 1 2 2 1 2 1 3 2 3 2 1 2 1 1 3 3 1 1
#> [39] 3 2
```

Ok, that looks not ideal, there are some misclassified nodes. Next, we
do a more extensive sampling of different good partitions and a plot of
average same block membership:

``` r
repeat_result <- repeat_sample_likely_partition(test_mat, n_blocks = 3, n_runs = 10, n_iter = 1000)
#> Run: 1 
#> Iteration: 100 Fit (AIC): 327773 
#> Iteration: 200 Fit (AIC): 327741.6 
#> Iteration: 300 Fit (AIC): 327754.7 
#> Iteration: 400 Fit (AIC): 327740.3 
#> Iteration: 500 Fit (AIC): 327737.2 
#> Iteration: 600 Fit (AIC): 327723.7 
#> Iteration: 700 Fit (AIC): 327704.5 
#> Iteration: 800 Fit (AIC): 327700.1 
#> Iteration: 900 Fit (AIC): 327693.9 
#> Iteration: 1000 Fit (AIC): 327703.5 
#> Iteration: 1100 Fit (AIC): 327694.6 
#> Iteration: 1200 Fit (AIC): 327686.7 
#> Iteration: 1300 Fit (AIC): 327686.9 
#> Iteration: 1400 Fit (AIC): 327692.3 
#> Iteration: 1500 Fit (AIC): 327692.3 
#> Iteration: 1600 Fit (AIC): 327698.5 
#> Iteration: 1700 Fit (AIC): 327699.2 
#> Iteration: 1800 Fit (AIC): 327699.2 
#> Iteration: 1900 Fit (AIC): 327687.1 
#> Iteration: 2000 Fit (AIC): 327691.3 
#> Iteration: 2100 Fit (AIC): 327687.7 
#> Iteration: 2200 Fit (AIC): 327678.4 
#> Iteration: 2300 Fit (AIC): 327692.5 
#> Iteration: 2400 Fit (AIC): 327697.6 
#> Iteration: 2500 Fit (AIC): 327693.6 
#> Iteration: 2600 Fit (AIC): 327691.7 
#> Iteration: 2700 Fit (AIC): 327685.8 
#> Iteration: 2800 Fit (AIC): 327680.3 
#> Iteration: 2900 Fit (AIC): 327680.5 
#> Iteration: 3000 Fit (AIC): 327683.3 
#> Iteration: 3100 Fit (AIC): 327683.3 
#> Iteration: 3200 Fit (AIC): 327684.3 
#> Iteration: 3300 Fit (AIC): 327684.3 
#> Iteration: 3400 Fit (AIC): 327680.9 
#> Iteration: 3500 Fit (AIC): 327680.5 
#> Iteration: 3600 Fit (AIC): 327680.9 
#> Iteration: 3700 Fit (AIC): 327683.3 
#> Iteration: 3800 Fit (AIC): 327679.1 
#> Iteration: 3900 Fit (AIC): 327678.4 
#> Iteration: 4000 Fit (AIC): 327679.2 
#> Iteration: 4100 Fit (AIC): 327680.6 
#> Iteration: 4200 Fit (AIC): 327680.6 
#> Iteration: 4300 Fit (AIC): 327682.9 
#> Iteration: 4400 Fit (AIC): 327683.9 
#> Iteration: 4500 Fit (AIC): 327684.4 
#> Iteration: 4600 Fit (AIC): 327679.2 
#> Iteration: 4700 Fit (AIC): 327683.6 
#> Iteration: 4800 Fit (AIC): 327680.1 
#> Iteration: 4900 Fit (AIC): 327676 
#> Iteration: 5000 Fit (AIC): 327676.9 
#> Run: 2 
#> Iteration: 100 Fit (AIC): 327676 
#> Iteration: 200 Fit (AIC): 327676 
#> Iteration: 300 Fit (AIC): 327680.1 
#> Iteration: 400 Fit (AIC): 327683.2 
#> Iteration: 500 Fit (AIC): 327679.1 
#> Iteration: 600 Fit (AIC): 327681.3 
#> Iteration: 700 Fit (AIC): 327681 
#> Iteration: 800 Fit (AIC): 327680.1 
#> Iteration: 900 Fit (AIC): 327676 
#> Iteration: 1000 Fit (AIC): 327676 
#> Run: 3 
#> Iteration: 100 Fit (AIC): 327676 
#> Iteration: 200 Fit (AIC): 327676 
#> Iteration: 300 Fit (AIC): 327679.2 
#> Iteration: 400 Fit (AIC): 327691.3 
#> Iteration: 500 Fit (AIC): 327684.5 
#> Iteration: 600 Fit (AIC): 327680.3 
#> Iteration: 700 Fit (AIC): 327680.3 
#> Iteration: 800 Fit (AIC): 327676 
#> Iteration: 900 Fit (AIC): 327676.9 
#> Iteration: 1000 Fit (AIC): 327684.8 
#> Run: 4 
#> Iteration: 100 Fit (AIC): 327693 
#> Iteration: 200 Fit (AIC): 327685.3 
#> Iteration: 300 Fit (AIC): 327692.3 
#> Iteration: 400 Fit (AIC): 327678.4 
#> Iteration: 500 Fit (AIC): 327676.9 
#> Iteration: 600 Fit (AIC): 327676.9 
#> Iteration: 700 Fit (AIC): 327686 
#> Iteration: 800 Fit (AIC): 327676.9 
#> Iteration: 900 Fit (AIC): 327676.9 
#> Iteration: 1000 Fit (AIC): 327676.9 
#> Run: 5 
#> Iteration: 100 Fit (AIC): 327676.9 
#> Iteration: 200 Fit (AIC): 327678.6 
#> Iteration: 300 Fit (AIC): 327682.6 
#> Iteration: 400 Fit (AIC): 327680.2 
#> Iteration: 500 Fit (AIC): 327701.8 
#> Iteration: 600 Fit (AIC): 327697.1 
#> Iteration: 700 Fit (AIC): 327686.2 
#> Iteration: 800 Fit (AIC): 327696.1 
#> Iteration: 900 Fit (AIC): 327692.8 
#> Iteration: 1000 Fit (AIC): 327694.2 
#> Run: 6 
#> Iteration: 100 Fit (AIC): 327695.2 
#> Iteration: 200 Fit (AIC): 327693.8 
#> Iteration: 300 Fit (AIC): 327691 
#> Iteration: 400 Fit (AIC): 327694.6 
#> Iteration: 500 Fit (AIC): 327687.9 
#> Iteration: 600 Fit (AIC): 327694.8 
#> Iteration: 700 Fit (AIC): 327690.6 
#> Iteration: 800 Fit (AIC): 327681 
#> Iteration: 900 Fit (AIC): 327681 
#> Iteration: 1000 Fit (AIC): 327676 
#> Run: 7 
#> Iteration: 100 Fit (AIC): 327678.4 
#> Iteration: 200 Fit (AIC): 327678.4 
#> Iteration: 300 Fit (AIC): 327676.9 
#> Iteration: 400 Fit (AIC): 327676.9 
#> Iteration: 500 Fit (AIC): 327679.2 
#> Iteration: 600 Fit (AIC): 327682 
#> Iteration: 700 Fit (AIC): 327682.9 
#> Iteration: 800 Fit (AIC): 327682.6 
#> Iteration: 900 Fit (AIC): 327686.9 
#> Iteration: 1000 Fit (AIC): 327678.4 
#> Run: 8 
#> Iteration: 100 Fit (AIC): 327682.3 
#> Iteration: 200 Fit (AIC): 327687 
#> Iteration: 300 Fit (AIC): 327698.9 
#> Iteration: 400 Fit (AIC): 327691.6 
#> Iteration: 500 Fit (AIC): 327683.2 
#> Iteration: 600 Fit (AIC): 327680.1 
#> Iteration: 700 Fit (AIC): 327678.6 
#> Iteration: 800 Fit (AIC): 327676 
#> Iteration: 900 Fit (AIC): 327680.5 
#> Iteration: 1000 Fit (AIC): 327680.5 
#> Run: 9 
#> Iteration: 100 Fit (AIC): 327680.5 
#> Iteration: 200 Fit (AIC): 327680.5 
#> Iteration: 300 Fit (AIC): 327676 
#> Iteration: 400 Fit (AIC): 327676 
#> Iteration: 500 Fit (AIC): 327682 
#> Iteration: 600 Fit (AIC): 327680.3 
#> Iteration: 700 Fit (AIC): 327693.5 
#> Iteration: 800 Fit (AIC): 327683.3 
#> Iteration: 900 Fit (AIC): 327680.9 
#> Iteration: 1000 Fit (AIC): 327680.9 
#> Run: 10 
#> Iteration: 100 Fit (AIC): 327687.2 
#> Iteration: 200 Fit (AIC): 327699.8 
#> Iteration: 300 Fit (AIC): 327682.8 
#> Iteration: 400 Fit (AIC): 327679.1 
#> Iteration: 500 Fit (AIC): 327678.4 
#> Iteration: 600 Fit (AIC): 327678.4 
#> Iteration: 700 Fit (AIC): 327676.9 
#> Iteration: 800 Fit (AIC): 327676.9 
#> Iteration: 900 Fit (AIC): 327680.3 
#> Iteration: 1000 Fit (AIC): 327682.8
repeat_result$partitions
#> [[1]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 3 3 3 3 3 3 3 3 2 3 2 2 2 2 3 2 2 2 3 2 2 2
#> [39] 2 2
#> 
#> [[2]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 3 3 3 3 3 3 3 3 2 2 2 2 2 2 3 2 2 2 3 2 2 2
#> [39] 2 2
#> 
#> [[3]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 3 3 3 3 3 3 3 3 2 3 2 2 2 3 3 2 2 3 3 2 2 2
#> [39] 2 2
#> 
#> [[4]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 3 3 3 3 3 3 3 3 2 3 2 2 2 2 3 2 2 2 3 2 2 2
#> [39] 2 2
#> 
#> [[5]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 3 2 3 3 3 3 2 3 2 2 2 2 2 3 2 1 2 2 2 2
#> [39] 2 2
#> 
#> [[6]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 3 3 3 3 3 3 3 3 2 2 2 2 2 2 3 2 2 2 3 2 2 2
#> [39] 2 2
#> 
#> [[7]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 3 3 3 3 3 3 3 3 2 3 2 2 2 3 3 2 2 2 3 2 2 2
#> [39] 2 2
#> 
#> [[8]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 3 2 3 3 3 3 3 3 2 2 2 2 2 2 3 2 2 2 3 2 2 2
#> [39] 2 2
#> 
#> [[9]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 3 3 3 3 3 3 2 3 2 2 2 2 3 2 2 2 3 2 2 2
#> [39] 2 2
#> 
#> [[10]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 3 3 3 3 3 3 3 3 2 3 2 2 2 2 2 2 2 1 3 2 2 2
#> [39] 2 2

average_partition_matrix(repeat_result)
```

<img src="man/figures/README-unnamed-chunk-4-1.png" width="100%" />

    #>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
    #>  [1,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #>  [2,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #>  [3,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #>  [4,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #>  [5,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #>  [6,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #>  [7,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #>  [8,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #>  [9,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #> [10,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #> [11,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #> [12,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #> [13,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #> [14,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #> [15,]  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   1.0
    #> [16,]  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2   0.2   0.2   0.2   0.2
    #> [17,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [18,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [19,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [20,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [21,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [22,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [23,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [24,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [25,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [26,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [27,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [28,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [29,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [30,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [31,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [32,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [33,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [34,]  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2   0.2   0.2   0.2   0.2
    #> [35,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [36,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [37,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [38,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [39,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [40,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #>       [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]
    #>  [1,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [2,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [3,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [4,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [5,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [6,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [7,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [8,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [9,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #> [10,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #> [11,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #> [12,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #> [13,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #> [14,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #> [15,]   1.0   1.0   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
    #> [16,]   0.2   0.2   1.0   0.8   0.7   0.8   0.8   0.8   0.8   0.8   0.8   0.0
    #> [17,]   0.0   0.0   0.8   1.0   0.8   0.9   1.0   0.9   0.9   0.9   0.9   0.1
    #> [18,]   0.0   0.0   0.7   0.8   1.0   0.7   0.8   0.7   0.7   0.7   0.7   0.3
    #> [19,]   0.0   0.0   0.8   0.9   0.7   1.0   0.9   1.0   1.0   1.0   1.0   0.0
    #> [20,]   0.0   0.0   0.8   1.0   0.8   0.9   1.0   0.9   0.9   0.9   0.9   0.1
    #> [21,]   0.0   0.0   0.8   0.9   0.7   1.0   0.9   1.0   1.0   1.0   1.0   0.0
    #> [22,]   0.0   0.0   0.8   0.9   0.7   1.0   0.9   1.0   1.0   1.0   1.0   0.0
    #> [23,]   0.0   0.0   0.8   0.9   0.7   1.0   0.9   1.0   1.0   1.0   1.0   0.0
    #> [24,]   0.0   0.0   0.8   0.9   0.7   1.0   0.9   1.0   1.0   1.0   1.0   0.0
    #> [25,]   0.0   0.0   0.0   0.1   0.3   0.0   0.1   0.0   0.0   0.0   0.0   1.0
    #> [26,]   0.0   0.0   0.5   0.6   0.6   0.7   0.6   0.7   0.7   0.7   0.7   0.3
    #> [27,]   0.0   0.0   0.0   0.1   0.3   0.0   0.1   0.0   0.0   0.0   0.0   1.0
    #> [28,]   0.0   0.0   0.0   0.1   0.3   0.0   0.1   0.0   0.0   0.0   0.0   1.0
    #> [29,]   0.0   0.0   0.0   0.1   0.3   0.0   0.1   0.0   0.0   0.0   0.0   1.0
    #> [30,]   0.0   0.0   0.2   0.3   0.5   0.2   0.3   0.2   0.2   0.2   0.2   0.8
    #> [31,]   0.0   0.0   0.7   0.9   0.7   0.8   0.9   0.8   0.8   0.8   0.8   0.2
    #> [32,]   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.1   0.1   0.1   0.1   0.9
    #> [33,]   0.0   0.0   0.0   0.1   0.3   0.0   0.1   0.0   0.0   0.0   0.0   1.0
    #> [34,]   0.2   0.2   0.2   0.1   0.3   0.1   0.1   0.1   0.1   0.1   0.1   0.7
    #> [35,]   0.0   0.0   0.8   1.0   0.8   0.9   1.0   0.9   0.9   0.9   0.9   0.1
    #> [36,]   0.0   0.0   0.0   0.1   0.3   0.0   0.1   0.0   0.0   0.0   0.0   1.0
    #> [37,]   0.0   0.0   0.0   0.1   0.3   0.0   0.1   0.0   0.0   0.0   0.0   1.0
    #> [38,]   0.0   0.0   0.0   0.1   0.3   0.0   0.1   0.0   0.0   0.0   0.0   1.0
    #> [39,]   0.0   0.0   0.0   0.1   0.3   0.0   0.1   0.0   0.0   0.0   0.0   1.0
    #> [40,]   0.0   0.0   0.0   0.1   0.3   0.0   0.1   0.0   0.0   0.0   0.0   1.0
    #>       [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37]
    #>  [1,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #>  [2,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #>  [3,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #>  [4,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #>  [5,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #>  [6,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #>  [7,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #>  [8,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #>  [9,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #> [10,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #> [11,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #> [12,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #> [13,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #> [14,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #> [15,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.0   0.0   0.0
    #> [16,]   0.5   0.0   0.0   0.0   0.2   0.7   0.0   0.0   0.2   0.8   0.0   0.0
    #> [17,]   0.6   0.1   0.1   0.1   0.3   0.9   0.0   0.1   0.1   1.0   0.1   0.1
    #> [18,]   0.6   0.3   0.3   0.3   0.5   0.7   0.2   0.3   0.3   0.8   0.3   0.3
    #> [19,]   0.7   0.0   0.0   0.0   0.2   0.8   0.1   0.0   0.1   0.9   0.0   0.0
    #> [20,]   0.6   0.1   0.1   0.1   0.3   0.9   0.0   0.1   0.1   1.0   0.1   0.1
    #> [21,]   0.7   0.0   0.0   0.0   0.2   0.8   0.1   0.0   0.1   0.9   0.0   0.0
    #> [22,]   0.7   0.0   0.0   0.0   0.2   0.8   0.1   0.0   0.1   0.9   0.0   0.0
    #> [23,]   0.7   0.0   0.0   0.0   0.2   0.8   0.1   0.0   0.1   0.9   0.0   0.0
    #> [24,]   0.7   0.0   0.0   0.0   0.2   0.8   0.1   0.0   0.1   0.9   0.0   0.0
    #> [25,]   0.3   1.0   1.0   1.0   0.8   0.2   0.9   1.0   0.7   0.1   1.0   1.0
    #> [26,]   1.0   0.3   0.3   0.3   0.5   0.5   0.4   0.3   0.4   0.6   0.3   0.3
    #> [27,]   0.3   1.0   1.0   1.0   0.8   0.2   0.9   1.0   0.7   0.1   1.0   1.0
    #> [28,]   0.3   1.0   1.0   1.0   0.8   0.2   0.9   1.0   0.7   0.1   1.0   1.0
    #> [29,]   0.3   1.0   1.0   1.0   0.8   0.2   0.9   1.0   0.7   0.1   1.0   1.0
    #> [30,]   0.5   0.8   0.8   0.8   1.0   0.4   0.7   0.8   0.7   0.3   0.8   0.8
    #> [31,]   0.5   0.2   0.2   0.2   0.4   1.0   0.1   0.2   0.1   0.9   0.2   0.2
    #> [32,]   0.4   0.9   0.9   0.9   0.7   0.1   1.0   0.9   0.7   0.0   0.9   0.9
    #> [33,]   0.3   1.0   1.0   1.0   0.8   0.2   0.9   1.0   0.7   0.1   1.0   1.0
    #> [34,]   0.4   0.7   0.7   0.7   0.7   0.1   0.7   0.7   1.0   0.1   0.7   0.7
    #> [35,]   0.6   0.1   0.1   0.1   0.3   0.9   0.0   0.1   0.1   1.0   0.1   0.1
    #> [36,]   0.3   1.0   1.0   1.0   0.8   0.2   0.9   1.0   0.7   0.1   1.0   1.0
    #> [37,]   0.3   1.0   1.0   1.0   0.8   0.2   0.9   1.0   0.7   0.1   1.0   1.0
    #> [38,]   0.3   1.0   1.0   1.0   0.8   0.2   0.9   1.0   0.7   0.1   1.0   1.0
    #> [39,]   0.3   1.0   1.0   1.0   0.8   0.2   0.9   1.0   0.7   0.1   1.0   1.0
    #> [40,]   0.3   1.0   1.0   1.0   0.8   0.2   0.9   1.0   0.7   0.1   1.0   1.0
    #>       [,38] [,39] [,40]
    #>  [1,]   0.0   0.0   0.0
    #>  [2,]   0.0   0.0   0.0
    #>  [3,]   0.0   0.0   0.0
    #>  [4,]   0.0   0.0   0.0
    #>  [5,]   0.0   0.0   0.0
    #>  [6,]   0.0   0.0   0.0
    #>  [7,]   0.0   0.0   0.0
    #>  [8,]   0.0   0.0   0.0
    #>  [9,]   0.0   0.0   0.0
    #> [10,]   0.0   0.0   0.0
    #> [11,]   0.0   0.0   0.0
    #> [12,]   0.0   0.0   0.0
    #> [13,]   0.0   0.0   0.0
    #> [14,]   0.0   0.0   0.0
    #> [15,]   0.0   0.0   0.0
    #> [16,]   0.0   0.0   0.0
    #> [17,]   0.1   0.1   0.1
    #> [18,]   0.3   0.3   0.3
    #> [19,]   0.0   0.0   0.0
    #> [20,]   0.1   0.1   0.1
    #> [21,]   0.0   0.0   0.0
    #> [22,]   0.0   0.0   0.0
    #> [23,]   0.0   0.0   0.0
    #> [24,]   0.0   0.0   0.0
    #> [25,]   1.0   1.0   1.0
    #> [26,]   0.3   0.3   0.3
    #> [27,]   1.0   1.0   1.0
    #> [28,]   1.0   1.0   1.0
    #> [29,]   1.0   1.0   1.0
    #> [30,]   0.8   0.8   0.8
    #> [31,]   0.2   0.2   0.2
    #> [32,]   0.9   0.9   0.9
    #> [33,]   1.0   1.0   1.0
    #> [34,]   0.7   0.7   0.7
    #> [35,]   0.1   0.1   0.1
    #> [36,]   1.0   1.0   1.0
    #> [37,]   1.0   1.0   1.0
    #> [38,]   1.0   1.0   1.0
    #> [39,]   1.0   1.0   1.0
    #> [40,]   1.0   1.0   1.0

Now that looks better. We can also use this output to optimise the
different sampled partitions to find the best (from our current
partitioning).

``` r
get_good_partitions(repeat_result)
#> Iteration: 1 Fit (AIC): 327676.9 
#> Iteration: 2 Fit (AIC): 327676 
#> Iteration: 1 Fit (AIC): 327676 
#> Iteration: 1 Fit (AIC): 327684.8 
#> Iteration: 2 Fit (AIC): 327678.4 
#> Iteration: 3 Fit (AIC): 327676.9 
#> Iteration: 4 Fit (AIC): 327676 
#> Iteration: 1 Fit (AIC): 327676.9 
#> Iteration: 2 Fit (AIC): 327676 
#> Iteration: 1 Fit (AIC): 327694.2 
#> Iteration: 2 Fit (AIC): 327688.8 
#> Iteration: 3 Fit (AIC): 327683.3 
#> Iteration: 1 Fit (AIC): 327676 
#> Iteration: 1 Fit (AIC): 327678.4 
#> Iteration: 2 Fit (AIC): 327676.9 
#> Iteration: 3 Fit (AIC): 327676 
#> Iteration: 1 Fit (AIC): 327680.5 
#> Iteration: 2 Fit (AIC): 327676 
#> Iteration: 1 Fit (AIC): 327680.9 
#> Iteration: 2 Fit (AIC): 327678.6 
#> Iteration: 3 Fit (AIC): 327676.9 
#> Iteration: 4 Fit (AIC): 327676 
#> Iteration: 1 Fit (AIC): 327682.8 
#> Iteration: 2 Fit (AIC): 327680.3 
#> Iteration: 3 Fit (AIC): 327676.9 
#> Iteration: 4 Fit (AIC): 327676
#> $n_unique_partitions
#> [1] 2
#> 
#> $all_fits
#>      fit      fit      fit      fit      fit      fit      fit      fit 
#> 327676.0 327676.0 327676.0 327676.0 327683.3 327676.0 327676.0 327676.0 
#>      fit      fit 
#> 327676.0 327676.0 
#> 
#> $best_partition
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 3 3 3 3 3 3 3 3 2 2 2 2 2 2 3 2 2 2 3 2 2 2
#> [39] 2 2
#> 
#> $best_fit
#> $best_fit$coefficients
#> NULL
#> 
#> $best_fit$fit
#> [1] 327676
```

This tells us how many different solutions are found (fewer = better)
and what the best partition is.
