
<!-- README.md is generated from README.Rmd. Please edit that file -->

# stocBM

A set of functions to get the partitions of a stochastic blockmodel for
mobility networks; that is, for a cross-classification matrix in which
rowsums differ between rows AND rowsums and columnsums differ. In other
words, a stochastic blockmodel for directed, weighted networks, which is
conditional on the in- and out-degree distribution.

## Installation

You can install the current version of stocBM from GitHub using:

``` r
# install.packages("remotes")
remotes::install_github("perblock/stocBM")
```

## Small example

First, we create a matrix of counts as an example and add some
structure:

``` r
library(stocBM)

test_mat <- matrix(rpois(1600, lambda = 10), nrow = 40, ncol = 40)
test_mat[1:15, 1:15] <- test_mat[1:15, 1:15] + 2  # Add some structure
test_mat[25:40, 16:24] <- test_mat[25:40, 16:24] + 3  # Add some structure

# Look at the first rows and columns
test_mat[1:10, 1:10]
#>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
#>  [1,]   12    8   12    9   14   14    8   16   11    16
#>  [2,]    6    9   16   10   12   14    7   16   12    12
#>  [3,]   14   11   13   15   16   16   11   10   17     8
#>  [4,]   11    5   10   10   13   11   11   11   12    13
#>  [5,]   12   16   16   12   11    9   11   17   11    12
#>  [6,]    9   10   16   14   11   12    8   13   12    10
#>  [7,]   11   16    7    7   10   15   15   14   13    10
#>  [8,]   10   12   14   12   12    8    8   17   12     7
#>  [9,]   13   16   11   16   12   12    7   12   13    14
#> [10,]   17   12    9   13   14   11   12   13   13     5
```

Now we can run a simple first test to get a (probably) preliminary
partitioning. In case the partitions are very clear, this might already
be pretty good.

``` r
init_res <- repeat_until_no_improvement(test_mat, n_blocks = 3, max_iter = 1000)
#> Iteration: 1 Fit (AIC): 327627.7 
#> Iteration: 2 Fit (AIC): 327624.3 
#> Iteration: 3 Fit (AIC): 327619.8 
#> Iteration: 4 Fit (AIC): 327615.4 
#> Iteration: 5 Fit (AIC): 327612.4 
#> Iteration: 6 Fit (AIC): 327608.1 
#> Iteration: 7 Fit (AIC): 327604.6 
#> Iteration: 8 Fit (AIC): 327599.5 
#> Iteration: 9 Fit (AIC): 327596 
#> Iteration: 10 Fit (AIC): 327590.5 
#> Iteration: 11 Fit (AIC): 327582.7 
#> Iteration: 12 Fit (AIC): 327580.3 
#> Iteration: 13 Fit (AIC): 327578.3 
#> Iteration: 14 Fit (AIC): 327575.1 
#> Iteration: 15 Fit (AIC): 327573 
#> Iteration: 16 Fit (AIC): 327572.2 
#> Iteration: 17 Fit (AIC): 327569.9 
#> Iteration: 18 Fit (AIC): 327568 
#> Iteration: 19 Fit (AIC): 327567.3 
#> Iteration: 20 Fit (AIC): 327567 
#> Iteration: 21 Fit (AIC): 327565.9 
#> Iteration: 22 Fit (AIC): 327564.3 
#> Iteration: 23 Fit (AIC): 327562.7 
#> Iteration: 24 Fit (AIC): 327559.2 
#> Iteration: 25 Fit (AIC): 327553.6 
#> Iteration: 26 Fit (AIC): 327552.9
init_res$partition
#>  [1] 3 2 1 3 3 2 3 2 3 2 2 3 3 2 3 1 3 1 3 1 1 3 1 1 1 1 1 1 3 2 1 1 2 2 1 1 1 2
#> [39] 2 1
```

Ok, that looks not ideal, there are some misclassified nodes. Next, we
do a more extensive sampling of different good partitions and a plot of
average same block membership:

``` r
repeat_result <- repeat_sample_likely_partition(test_mat, n_blocks = 3, n_runs = 10, n_iter = 1000)
#> Run: 1 
#> Iteration: 100 Fit (AIC): 327619.5 
#> Iteration: 200 Fit (AIC): 327623.2 
#> Iteration: 300 Fit (AIC): 327608.6 
#> Iteration: 400 Fit (AIC): 327591.5 
#> Iteration: 500 Fit (AIC): 327588.8 
#> Iteration: 600 Fit (AIC): 327569.3 
#> Iteration: 700 Fit (AIC): 327562.8 
#> Iteration: 800 Fit (AIC): 327569.3 
#> Iteration: 900 Fit (AIC): 327571.5 
#> Iteration: 1000 Fit (AIC): 327566.3 
#> Iteration: 1100 Fit (AIC): 327566.2 
#> Iteration: 1200 Fit (AIC): 327588.6 
#> Iteration: 1300 Fit (AIC): 327570.7 
#> Iteration: 1400 Fit (AIC): 327561.8 
#> Iteration: 1500 Fit (AIC): 327577.4 
#> Iteration: 1600 Fit (AIC): 327560.7 
#> Iteration: 1700 Fit (AIC): 327528.6 
#> Iteration: 1800 Fit (AIC): 327521.5 
#> Iteration: 1900 Fit (AIC): 327524.5 
#> Iteration: 2000 Fit (AIC): 327521.6 
#> Iteration: 2100 Fit (AIC): 327525.9 
#> Iteration: 2200 Fit (AIC): 327525.9 
#> Iteration: 2300 Fit (AIC): 327523.3 
#> Iteration: 2400 Fit (AIC): 327523.8 
#> Iteration: 2500 Fit (AIC): 327530.2 
#> Iteration: 2600 Fit (AIC): 327528.5 
#> Iteration: 2700 Fit (AIC): 327529.5 
#> Iteration: 2800 Fit (AIC): 327533.6 
#> Iteration: 2900 Fit (AIC): 327537.8 
#> Iteration: 3000 Fit (AIC): 327539.4 
#> Iteration: 3100 Fit (AIC): 327525.9 
#> Iteration: 3200 Fit (AIC): 327528 
#> Iteration: 3300 Fit (AIC): 327522.9 
#> Iteration: 3400 Fit (AIC): 327528 
#> Iteration: 3500 Fit (AIC): 327527.1 
#> Iteration: 3600 Fit (AIC): 327532.7 
#> Iteration: 3700 Fit (AIC): 327522.3 
#> Iteration: 3800 Fit (AIC): 327523.8 
#> Iteration: 3900 Fit (AIC): 327523.3 
#> Iteration: 4000 Fit (AIC): 327521.5 
#> Iteration: 4100 Fit (AIC): 327526.5 
#> Iteration: 4200 Fit (AIC): 327537.9 
#> Iteration: 4300 Fit (AIC): 327521.5 
#> Iteration: 4400 Fit (AIC): 327525.2 
#> Iteration: 4500 Fit (AIC): 327523.2 
#> Iteration: 4600 Fit (AIC): 327536.4 
#> Iteration: 4700 Fit (AIC): 327529.9 
#> Iteration: 4800 Fit (AIC): 327533.7 
#> Iteration: 4900 Fit (AIC): 327527.1 
#> Iteration: 5000 Fit (AIC): 327527.3 
#> Run: 2 
#> Iteration: 100 Fit (AIC): 327529.5 
#> Iteration: 200 Fit (AIC): 327537.7 
#> Iteration: 300 Fit (AIC): 327539.8 
#> Iteration: 400 Fit (AIC): 327525.8 
#> Iteration: 500 Fit (AIC): 327533.5 
#> Iteration: 600 Fit (AIC): 327521.6 
#> Iteration: 700 Fit (AIC): 327527.1 
#> Iteration: 800 Fit (AIC): 327521.6 
#> Iteration: 900 Fit (AIC): 327521.8 
#> Iteration: 1000 Fit (AIC): 327521.6 
#> Run: 3 
#> Iteration: 100 Fit (AIC): 327528 
#> Iteration: 200 Fit (AIC): 327532.2 
#> Iteration: 300 Fit (AIC): 327532.5 
#> Iteration: 400 Fit (AIC): 327526.1 
#> Iteration: 500 Fit (AIC): 327521.8 
#> Iteration: 600 Fit (AIC): 327521.8 
#> Iteration: 700 Fit (AIC): 327521.8 
#> Iteration: 800 Fit (AIC): 327521.5 
#> Iteration: 900 Fit (AIC): 327521.5 
#> Iteration: 1000 Fit (AIC): 327524 
#> Run: 4 
#> Iteration: 100 Fit (AIC): 327533.5 
#> Iteration: 200 Fit (AIC): 327532 
#> Iteration: 300 Fit (AIC): 327526.3 
#> Iteration: 400 Fit (AIC): 327529.4 
#> Iteration: 500 Fit (AIC): 327529.4 
#> Iteration: 600 Fit (AIC): 327528.9 
#> Iteration: 700 Fit (AIC): 327528.9 
#> Iteration: 800 Fit (AIC): 327527.3 
#> Iteration: 900 Fit (AIC): 327527.3 
#> Iteration: 1000 Fit (AIC): 327527.3 
#> Run: 5 
#> Iteration: 100 Fit (AIC): 327527.4 
#> Iteration: 200 Fit (AIC): 327527.3 
#> Iteration: 300 Fit (AIC): 327529.6 
#> Iteration: 400 Fit (AIC): 327532.8 
#> Iteration: 500 Fit (AIC): 327533.5 
#> Iteration: 600 Fit (AIC): 327535 
#> Iteration: 700 Fit (AIC): 327538.3 
#> Iteration: 800 Fit (AIC): 327531.2 
#> Iteration: 900 Fit (AIC): 327540.2 
#> Iteration: 1000 Fit (AIC): 327526.2 
#> Run: 6 
#> Iteration: 100 Fit (AIC): 327534.6 
#> Iteration: 200 Fit (AIC): 327521.6 
#> Iteration: 300 Fit (AIC): 327526.3 
#> Iteration: 400 Fit (AIC): 327529.8 
#> Iteration: 500 Fit (AIC): 327537.1 
#> Iteration: 600 Fit (AIC): 327527.2 
#> Iteration: 700 Fit (AIC): 327533.2 
#> Iteration: 800 Fit (AIC): 327523.3 
#> Iteration: 900 Fit (AIC): 327532.4 
#> Iteration: 1000 Fit (AIC): 327532.4 
#> Run: 7 
#> Iteration: 100 Fit (AIC): 327535.6 
#> Iteration: 200 Fit (AIC): 327526.7 
#> Iteration: 300 Fit (AIC): 327521.8 
#> Iteration: 400 Fit (AIC): 327526.4 
#> Iteration: 500 Fit (AIC): 327521.8 
#> Iteration: 600 Fit (AIC): 327523.8 
#> Iteration: 700 Fit (AIC): 327523.8 
#> Iteration: 800 Fit (AIC): 327528.6 
#> Iteration: 900 Fit (AIC): 327521.8 
#> Iteration: 1000 Fit (AIC): 327526.4 
#> Run: 8 
#> Iteration: 100 Fit (AIC): 327526.4 
#> Iteration: 200 Fit (AIC): 327526.3 
#> Iteration: 300 Fit (AIC): 327529.8 
#> Iteration: 400 Fit (AIC): 327539.2 
#> Iteration: 500 Fit (AIC): 327536 
#> Iteration: 600 Fit (AIC): 327530 
#> Iteration: 700 Fit (AIC): 327540.8 
#> Iteration: 800 Fit (AIC): 327538.9 
#> Iteration: 900 Fit (AIC): 327536.2 
#> Iteration: 1000 Fit (AIC): 327536.8 
#> Run: 9 
#> Iteration: 100 Fit (AIC): 327536.8 
#> Iteration: 200 Fit (AIC): 327528.5 
#> Iteration: 300 Fit (AIC): 327528.5 
#> Iteration: 400 Fit (AIC): 327528 
#> Iteration: 500 Fit (AIC): 327528 
#> Iteration: 600 Fit (AIC): 327527.8 
#> Iteration: 700 Fit (AIC): 327526.2 
#> Iteration: 800 Fit (AIC): 327524 
#> Iteration: 900 Fit (AIC): 327524.9 
#> Iteration: 1000 Fit (AIC): 327525.8 
#> Run: 10 
#> Iteration: 100 Fit (AIC): 327525.8 
#> Iteration: 200 Fit (AIC): 327521.5 
#> Iteration: 300 Fit (AIC): 327524 
#> Iteration: 400 Fit (AIC): 327538.9 
#> Iteration: 500 Fit (AIC): 327521.5 
#> Iteration: 600 Fit (AIC): 327538.4 
#> Iteration: 700 Fit (AIC): 327543.3 
#> Iteration: 800 Fit (AIC): 327537.9 
#> Iteration: 900 Fit (AIC): 327527.1 
#> Iteration: 1000 Fit (AIC): 327527.1
repeat_result$partitions
#> [[1]]
#>  [1] 1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 3 3 2 3 3 3 3 3 3 3 3 3 3 3
#> [39] 3 3
#> 
#> [[2]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 1 2 2 2 2 2 3 3 3 3 3 3 2 3 3 3 3 3 3 3
#> [39] 3 3
#> 
#> [[3]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 3 3 3 3 2 3 3 3 3 3 3 3 3 3
#> [39] 3 3
#> 
#> [[4]]
#>  [1] 3 1 1 1 1 1 1 1 1 1 1 1 2 1 1 2 2 2 3 2 2 2 2 2 3 3 3 3 3 3 3 3 3 1 3 3 3 3
#> [39] 3 3
#> 
#> [[5]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 3 3 3 3 2 3 2 3 3 3 3 3 3 3
#> [39] 3 3
#> 
#> [[6]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 1 3 3 1
#> [39] 3 1
#> 
#> [[7]]
#>  [1] 3 3 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 1 2 2 2 2 2 3 3 3 3 3 3 2 3 3 3 3 3 3 3
#> [39] 3 3
#> 
#> [[8]]
#>  [1] 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 1 2 2 2 2 2 2 2 2 3 2 3 2 3 3 3 3 3 3 1
#> [39] 3 3
#> 
#> [[9]]
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 3 3 2 3 3 3 3 3 3 3 3 3 3 1
#> [39] 3 3
#> 
#> [[10]]
#>  [1] 3 1 1 1 1 1 1 1 1 1 1 1 2 1 1 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 1 3 3 3 1
#> [39] 3 3

average_partition_matrix(repeat_result)
```

<img src="man/figures/README-unnamed-chunk-4-1.png" width="100%" />

    #>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
    #>  [1,]  1.0  0.6  0.6  0.6  0.6  0.6  0.6  0.6  0.6   0.6   0.6   0.6   0.6
    #>  [2,]  0.6  1.0  0.8  0.8  0.8  0.8  0.8  0.8  0.8   0.8   0.8   0.8   0.6
    #>  [3,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #>  [4,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #>  [5,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #>  [6,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #>  [7,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #>  [8,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #>  [9,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #> [10,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #> [11,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #> [12,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #> [13,]  0.6  0.6  0.8  0.8  0.8  0.8  0.8  0.8  0.8   0.8   0.8   0.8   1.0
    #> [14,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #> [15,]  0.6  0.8  1.0  1.0  1.0  1.0  1.0  1.0  1.0   1.0   1.0   1.0   0.8
    #> [16,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.2
    #> [17,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.2
    #> [18,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.2
    #> [19,]  0.2  0.2  0.3  0.3  0.3  0.3  0.3  0.3  0.3   0.3   0.3   0.3   0.4
    #> [20,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.2
    #> [21,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.2
    #> [22,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.2
    #> [23,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.2
    #> [24,]  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.2
    #> [25,]  0.3  0.2  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [26,]  0.3  0.2  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [27,]  0.3  0.1  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [28,]  0.4  0.2  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [29,]  0.3  0.2  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [30,]  0.4  0.2  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [31,]  0.2  0.1  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [32,]  0.4  0.2  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [33,]  0.4  0.2  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [34,]  0.2  0.4  0.2  0.2  0.2  0.2  0.2  0.2  0.2   0.2   0.2   0.2   0.0
    #> [35,]  0.5  0.3  0.1  0.1  0.1  0.1  0.1  0.1  0.1   0.1   0.1   0.1   0.1
    #> [36,]  0.4  0.2  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [37,]  0.4  0.2  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [38,]  0.4  0.6  0.4  0.4  0.4  0.4  0.4  0.4  0.4   0.4   0.4   0.4   0.3
    #> [39,]  0.4  0.2  0.0  0.0  0.0  0.0  0.0  0.0  0.0   0.0   0.0   0.0   0.0
    #> [40,]  0.5  0.3  0.1  0.1  0.1  0.1  0.1  0.1  0.1   0.1   0.1   0.1   0.1
    #>       [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]
    #>  [1,]   0.6   0.6   0.0   0.0   0.0   0.2   0.0   0.0   0.0   0.0   0.0   0.3
    #>  [2,]   0.8   0.8   0.0   0.0   0.0   0.2   0.0   0.0   0.0   0.0   0.0   0.2
    #>  [3,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [4,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [5,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [6,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [7,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [8,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #>  [9,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #> [10,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #> [11,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #> [12,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #> [13,]   0.8   0.8   0.2   0.2   0.2   0.4   0.2   0.2   0.2   0.2   0.2   0.0
    #> [14,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #> [15,]   1.0   1.0   0.0   0.0   0.0   0.3   0.0   0.0   0.0   0.0   0.0   0.0
    #> [16,]   0.0   0.0   1.0   1.0   1.0   0.6   1.0   1.0   1.0   1.0   1.0   0.1
    #> [17,]   0.0   0.0   1.0   1.0   1.0   0.6   1.0   1.0   1.0   1.0   1.0   0.1
    #> [18,]   0.0   0.0   1.0   1.0   1.0   0.6   1.0   1.0   1.0   1.0   1.0   0.1
    #> [19,]   0.3   0.3   0.6   0.6   0.6   1.0   0.6   0.6   0.6   0.6   0.6   0.1
    #> [20,]   0.0   0.0   1.0   1.0   1.0   0.6   1.0   1.0   1.0   1.0   1.0   0.1
    #> [21,]   0.0   0.0   1.0   1.0   1.0   0.6   1.0   1.0   1.0   1.0   1.0   0.1
    #> [22,]   0.0   0.0   1.0   1.0   1.0   0.6   1.0   1.0   1.0   1.0   1.0   0.1
    #> [23,]   0.0   0.0   1.0   1.0   1.0   0.6   1.0   1.0   1.0   1.0   1.0   0.1
    #> [24,]   0.0   0.0   1.0   1.0   1.0   0.6   1.0   1.0   1.0   1.0   1.0   0.1
    #> [25,]   0.0   0.0   0.1   0.1   0.1   0.1   0.1   0.1   0.1   0.1   0.1   1.0
    #> [26,]   0.0   0.0   0.1   0.1   0.1   0.1   0.1   0.1   0.1   0.1   0.1   1.0
    #> [27,]   0.0   0.0   0.3   0.3   0.3   0.3   0.3   0.3   0.3   0.3   0.3   0.8
    #> [28,]   0.0   0.0   0.0   0.0   0.0   0.1   0.0   0.0   0.0   0.0   0.0   0.9
    #> [29,]   0.0   0.0   0.3   0.3   0.3   0.3   0.3   0.3   0.3   0.3   0.3   0.8
    #> [30,]   0.0   0.0   0.0   0.0   0.0   0.1   0.0   0.0   0.0   0.0   0.0   0.9
    #> [31,]   0.0   0.0   0.4   0.4   0.4   0.2   0.4   0.4   0.4   0.4   0.4   0.7
    #> [32,]   0.0   0.0   0.0   0.0   0.0   0.1   0.0   0.0   0.0   0.0   0.0   0.9
    #> [33,]   0.0   0.0   0.0   0.0   0.0   0.1   0.0   0.0   0.0   0.0   0.0   0.9
    #> [34,]   0.2   0.2   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.7
    #> [35,]   0.1   0.1   0.0   0.0   0.0   0.1   0.0   0.0   0.0   0.0   0.0   0.8
    #> [36,]   0.0   0.0   0.0   0.0   0.0   0.1   0.0   0.0   0.0   0.0   0.0   0.9
    #> [37,]   0.0   0.0   0.0   0.0   0.0   0.1   0.0   0.0   0.0   0.0   0.0   0.9
    #> [38,]   0.4   0.4   0.0   0.0   0.0   0.2   0.0   0.0   0.0   0.0   0.0   0.6
    #> [39,]   0.0   0.0   0.0   0.0   0.0   0.1   0.0   0.0   0.0   0.0   0.0   0.9
    #> [40,]   0.1   0.1   0.0   0.0   0.0   0.1   0.0   0.0   0.0   0.0   0.0   0.8
    #>       [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37]
    #>  [1,]   0.3   0.3   0.4   0.3   0.4   0.2   0.4   0.4   0.2   0.5   0.4   0.4
    #>  [2,]   0.2   0.1   0.2   0.2   0.2   0.1   0.2   0.2   0.4   0.3   0.2   0.2
    #>  [3,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #>  [4,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #>  [5,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #>  [6,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #>  [7,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #>  [8,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #>  [9,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #> [10,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #> [11,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #> [12,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #> [13,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.1   0.0   0.0
    #> [14,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #> [15,]   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.2   0.1   0.0   0.0
    #> [16,]   0.1   0.3   0.0   0.3   0.0   0.4   0.0   0.0   0.0   0.0   0.0   0.0
    #> [17,]   0.1   0.3   0.0   0.3   0.0   0.4   0.0   0.0   0.0   0.0   0.0   0.0
    #> [18,]   0.1   0.3   0.0   0.3   0.0   0.4   0.0   0.0   0.0   0.0   0.0   0.0
    #> [19,]   0.1   0.3   0.1   0.3   0.1   0.2   0.1   0.1   0.0   0.1   0.1   0.1
    #> [20,]   0.1   0.3   0.0   0.3   0.0   0.4   0.0   0.0   0.0   0.0   0.0   0.0
    #> [21,]   0.1   0.3   0.0   0.3   0.0   0.4   0.0   0.0   0.0   0.0   0.0   0.0
    #> [22,]   0.1   0.3   0.0   0.3   0.0   0.4   0.0   0.0   0.0   0.0   0.0   0.0
    #> [23,]   0.1   0.3   0.0   0.3   0.0   0.4   0.0   0.0   0.0   0.0   0.0   0.0
    #> [24,]   0.1   0.3   0.0   0.3   0.0   0.4   0.0   0.0   0.0   0.0   0.0   0.0
    #> [25,]   1.0   0.8   0.9   0.8   0.9   0.7   0.9   0.9   0.7   0.8   0.9   0.9
    #> [26,]   1.0   0.8   0.9   0.8   0.9   0.7   0.9   0.9   0.7   0.8   0.9   0.9
    #> [27,]   0.8   1.0   0.7   0.6   0.7   0.5   0.7   0.7   0.5   0.6   0.7   0.7
    #> [28,]   0.9   0.7   1.0   0.7   1.0   0.6   1.0   1.0   0.8   0.9   1.0   1.0
    #> [29,]   0.8   0.6   0.7   1.0   0.7   0.7   0.7   0.7   0.5   0.6   0.7   0.7
    #> [30,]   0.9   0.7   1.0   0.7   1.0   0.6   1.0   1.0   0.8   0.9   1.0   1.0
    #> [31,]   0.7   0.5   0.6   0.7   0.6   1.0   0.6   0.6   0.4   0.5   0.6   0.6
    #> [32,]   0.9   0.7   1.0   0.7   1.0   0.6   1.0   1.0   0.8   0.9   1.0   1.0
    #> [33,]   0.9   0.7   1.0   0.7   1.0   0.6   1.0   1.0   0.8   0.9   1.0   1.0
    #> [34,]   0.7   0.5   0.8   0.5   0.8   0.4   0.8   0.8   1.0   0.7   0.8   0.8
    #> [35,]   0.8   0.6   0.9   0.6   0.9   0.5   0.9   0.9   0.7   1.0   0.9   0.9
    #> [36,]   0.9   0.7   1.0   0.7   1.0   0.6   1.0   1.0   0.8   0.9   1.0   1.0
    #> [37,]   0.9   0.7   1.0   0.7   1.0   0.6   1.0   1.0   0.8   0.9   1.0   1.0
    #> [38,]   0.6   0.5   0.6   0.4   0.6   0.3   0.6   0.6   0.6   0.7   0.6   0.6
    #> [39,]   0.9   0.7   1.0   0.7   1.0   0.6   1.0   1.0   0.8   0.9   1.0   1.0
    #> [40,]   0.8   0.6   0.9   0.6   0.9   0.5   0.9   0.9   0.7   1.0   0.9   0.9
    #>       [,38] [,39] [,40]
    #>  [1,]   0.4   0.4   0.5
    #>  [2,]   0.6   0.2   0.3
    #>  [3,]   0.4   0.0   0.1
    #>  [4,]   0.4   0.0   0.1
    #>  [5,]   0.4   0.0   0.1
    #>  [6,]   0.4   0.0   0.1
    #>  [7,]   0.4   0.0   0.1
    #>  [8,]   0.4   0.0   0.1
    #>  [9,]   0.4   0.0   0.1
    #> [10,]   0.4   0.0   0.1
    #> [11,]   0.4   0.0   0.1
    #> [12,]   0.4   0.0   0.1
    #> [13,]   0.3   0.0   0.1
    #> [14,]   0.4   0.0   0.1
    #> [15,]   0.4   0.0   0.1
    #> [16,]   0.0   0.0   0.0
    #> [17,]   0.0   0.0   0.0
    #> [18,]   0.0   0.0   0.0
    #> [19,]   0.2   0.1   0.1
    #> [20,]   0.0   0.0   0.0
    #> [21,]   0.0   0.0   0.0
    #> [22,]   0.0   0.0   0.0
    #> [23,]   0.0   0.0   0.0
    #> [24,]   0.0   0.0   0.0
    #> [25,]   0.6   0.9   0.8
    #> [26,]   0.6   0.9   0.8
    #> [27,]   0.5   0.7   0.6
    #> [28,]   0.6   1.0   0.9
    #> [29,]   0.4   0.7   0.6
    #> [30,]   0.6   1.0   0.9
    #> [31,]   0.3   0.6   0.5
    #> [32,]   0.6   1.0   0.9
    #> [33,]   0.6   1.0   0.9
    #> [34,]   0.6   0.8   0.7
    #> [35,]   0.7   0.9   1.0
    #> [36,]   0.6   1.0   0.9
    #> [37,]   0.6   1.0   0.9
    #> [38,]   1.0   0.6   0.7
    #> [39,]   0.6   1.0   0.9
    #> [40,]   0.7   0.9   1.0

Now that looks better. We can also use this output to optimise the
different sampled partitions to find the best (from our current
partitioning).

``` r
get_good_partitions(repeat_result)
#> Iteration: 1 Fit (AIC): 327527.3 
#> Iteration: 2 Fit (AIC): 327523.8 
#> Iteration: 3 Fit (AIC): 327521.5 
#> Iteration: 1 Fit (AIC): 327521.6 
#> Iteration: 1 Fit (AIC): 327524 
#> Iteration: 2 Fit (AIC): 327521.5 
#> Iteration: 1 Fit (AIC): 327527.3 
#> Iteration: 2 Fit (AIC): 327526.1 
#> Iteration: 1 Fit (AIC): 327526.2 
#> Iteration: 2 Fit (AIC): 327522.3 
#> Iteration: 3 Fit (AIC): 327521.5 
#> Iteration: 1 Fit (AIC): 327532.4 
#> Iteration: 2 Fit (AIC): 327527.4 
#> Iteration: 3 Fit (AIC): 327522.6 
#> Iteration: 4 Fit (AIC): 327521.5 
#> Iteration: 1 Fit (AIC): 327526.4 
#> Iteration: 2 Fit (AIC): 327521.8 
#> Iteration: 3 Fit (AIC): 327521.6 
#> Iteration: 1 Fit (AIC): 327536.8 
#> Iteration: 2 Fit (AIC): 327534.7 
#> Iteration: 3 Fit (AIC): 327532.5 
#> Iteration: 4 Fit (AIC): 327529.8 
#> Iteration: 5 Fit (AIC): 327526.3 
#> Iteration: 6 Fit (AIC): 327524.5 
#> Iteration: 7 Fit (AIC): 327521.6 
#> Iteration: 1 Fit (AIC): 327525.8 
#> Iteration: 2 Fit (AIC): 327522.6 
#> Iteration: 3 Fit (AIC): 327521.5 
#> Iteration: 1 Fit (AIC): 327527.1 
#> Iteration: 2 Fit (AIC): 327522.9
#> $n_unique_partitions
#> [1] 4
#> 
#> $all_fits
#>      fit      fit      fit      fit      fit      fit      fit      fit 
#> 327521.5 327521.6 327521.5 327526.1 327521.5 327521.5 327521.6 327521.6 
#>      fit      fit 
#> 327521.5 327522.9 
#> 
#> $best_partition
#>  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 3 3 3 3
#> [39] 3 3
#> 
#> $best_fit
#> $best_fit$coefficients
#> NULL
#> 
#> $best_fit$fit
#> [1] 327521.5
```

This tells us how many different solutions are found (fewer = better)
and what the best partition is.
